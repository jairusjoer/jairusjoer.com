---
import { formatDatetime } from '@scripts/formatDatetime';
import { getCollection } from 'astro:content';

export interface Props {
  filter?: string;
}

const { filter } = Astro.props;

let collection = await getCollection('pages', ({ id }) => {
  if (id.endsWith('index')) return false;

  return filter ? id.startsWith(filter.toLowerCase()) : true;
});

collection = collection.sort((a, b) => {
  const dateA = a.data?.date ? new Date(a.data.date).getTime() : 0;
  const dateB = b.data?.date ? new Date(b.data.date).getTime() : 0;

  return dateB - dateA;
});

if (import.meta.env.PROD) {
  collection = collection.filter((entry) => !entry.data?.draft);
}
---

<ul>
  {
    collection.map((entry) => (
      <li>
        <article>
          <a href={`/${entry.id}`}>
            <strong>{entry.data.title}</strong>
          </a>
          {entry.data.date && (
            <>
              <br />
              <time>{formatDatetime(entry.data.date)}</time>
            </>
          )}
        </article>
      </li>
    ))
  }
</ul>
