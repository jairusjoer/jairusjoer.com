---
import Default from '../layouts/default.astro';
import type { Metadata } from '../types';
import { defaultMetadata } from '../constants';
import Category from '../components/astro/category.astro';
import Entry from '../components/astro/entry.astro';
import { getCollection } from 'astro:content';

// Logos
import Hannover from '../assets/logos/hannover.svg';
import Continental from '../assets/logos/continental.svg';
import Sparkasse from '../assets/logos/sparkasse.svg';
import LBS from '../assets/logos/lbs.svg';

const collection = await getCollection('cv');

const entriesByCategory = collection.reduce(
  (acc, entry) => {
    const category = entry.data.category;
    if (!acc[category]) {
      acc[category] = [];
    }
    acc[category].push(entry);
    return acc;
  },
  {} as Record<string, typeof collection>
);

Object.keys(entriesByCategory).forEach((category) => {
  entriesByCategory[category].sort((a, b) => {
    return new Date(b.data.date[0]).getTime() - new Date(a.data.date[0]).getTime();
  });
});

const categoryOrder = ['Experience', 'Awards', 'Projects', 'Speaking', 'Education'];
const orderedEntriesByCategory = Object.fromEntries(categoryOrder.map((cat) => [cat, entriesByCategory[cat]]));

const metadata: Metadata = {
  schema: {
    '@context': 'https://schema.org',
    '@type': 'ProfilePage',
    dateCreated: new Date().toISOString(),
    dateModified: new Date().toISOString(),
    mainEntity: {
      '@type': 'Person',
      name: defaultMetadata.title,
      alternateName: 'jairusjoer',
      identifier: 'jairusjoer',
      description: defaultMetadata.description,
      image: 'https://jairusjoer.com/avatar.jpeg',
      sameAs: [
        'https://aggregata.de/authors/jairusjoer/',
        'https://github.com/jairusjoer',
        'https://www.linkedin.com/in/jairusjoer/',
      ],
    },
  },
};

const formatDate = (dates: string[]) => {
  return dates
    .map((date: string) => {
      if (date === 'Present') return date;

      return new Date(date).toLocaleString('en', { year: 'numeric', month: 'short' });
    })
    .join(' â€” ');
};
---

<Default {metadata}>
  <main class="grow">
    <Category title="About">
      <div class="prose prose-theme">
        <p>
          I am a <strong>Senior Full Stack Developer</strong> and <strong>Designer</strong> based in Germany. I take great
          delight in my specialized work surrounding user experience, design systems, and accessibility, always striving
          to create intuitive and inclusive digital experiences.
        </p>
        <p>
          I have delivered measurable impact for tens of thousands of customers: cutting build times by 50%+, growing
          organic traffic by 120% YoY with a 33% conversion lift, and driving design system adoption across dozens of
          teams at various companies.
        </p>
        <p>
          I am currently spearheading HERO Software's platform modernization through monorepo orchestration and design
          system adoption. I am committed to design and engineering excellence, sharing these values with my colleagues.
        </p>

        <p><small>I had the privilege of working with:</small></p>
        <div class="not-prose flex flex-wrap items-end gap-x-12 gap-y-6 [&_svg]:w-auto">
          <div title="Sparkasse">
            <Sparkasse class="h-8" />
          </div>
          <div title="Continental">
            <Continental class="h-6" />
          </div>
          <div title="Hannover">
            <Hannover class="h-8" />
          </div>
          <div title="LBS">
            <LBS class="h-6" />
          </div>
        </div>
      </div>
    </Category>
  </main>
  {
    Object.keys(orderedEntriesByCategory).map((category) => (
      <Category title={category}>
        {orderedEntriesByCategory[category]?.map((entry) =>
          entry.rendered?.html.trim() ? (
            <Entry
              id={entry.id}
              content={{
                title: entry.data.title,
                subtitle: entry.data.subtitle,
                meta: formatDate(entry.data.date),
              }}
            >
              <Fragment set:html={entry.rendered?.html} />
            </Entry>
          ) : (
            <Entry
              id={entry.id}
              content={{
                title: entry.data.title,
                subtitle: entry.data.subtitle,
                meta: formatDate(entry.data.date),
              }}
            />
          )
        )}
      </Category>
    ))
  }
</Default>
